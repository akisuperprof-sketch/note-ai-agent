# note記事自動生成AIエージェント 仕様書

**バージョン**: 1.2.0  
**作成日**: 2025-12-19  
**最終更新**: 2025-12-25  

---

## 1. 製品概要

### 1.1 製品名
**note記事自動生成AIエージェント**

### 1.2 製品説明
ノウハウや一次情報を入力するだけで、「わど式」戦略企画メソッドに基づいた高品質なnote記事を自動生成するWebアプリケーション。

### 1.3 参考システム
- URL: https://note-ai-agent-2.unionai.co.jp/
- 機能: AI記事生成プラットフォーム

### 1.4 ターゲットユーザー
- note記事を書きたいが、構成に悩む人
- ノウハウはあるが文章化が苦手な人
- 効率的に質の高い記事を量産したい人

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 入力機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-001 | ノウハウ入力 | テキストエリアでノウハウ・一次情報を入力 | 必須 |
| F-002 | 戦略企画設定 | わど式に基づく6項目の設定 | 必須 |
| F-003 | 基本設定 | 文体・読者層・文字数等の設定 | 必須 |
| F-004 | 画像アップロード | 参考画像のアップロード（オプション） | 任意 |

#### 2.1.2 生成機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-010 | タイトル生成 | 5つのタイトル候補を生成 | 必須 |
| F-011 | 構成案生成 | 記事の見出し構成を生成 | 必須 |
| F-012 | 本文生成 | Markdown形式で記事本文を生成 | 必須 |
| F-013 | 一括生成 | タイトル→構成→本文を自動で一括生成 | 必須 |
| F-014 | ストリーミング | 生成中のリアルタイム表示 | 推奨 |

#### 2.1.3 出力機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-020 | プレビュー表示 | Markdownのリアルタイムプレビュー | 必須 |
| F-021 | コピー機能 | 生成結果をクリップボードにコピー | 必須 |
| F-022 | エクスポート | Markdownファイルとしてダウンロード | 推奨 |
| F-023 | メタディスクリプション | SEO用の説明文を自動生成 | 必須 |

#### 2.1.4 モード切替
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-030 | 段階的制作モード | タブで段階的に生成を進める | 必須 |
| F-031 | 通常モード | 一括で記事全体を生成 | 必須 |

#### 2.1.5 履歴管理機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-040 | 保存機能 | 生成されたタイトル、構成、本文をブラウザローカルストレージに保存 | 必須 |
| F-041 | 履歴表示機能 | 保存された履歴一覧を表示し、選択して復元できる | 必須 |

---

## 3. 非機能要件

### 3.1 パフォーマンス
| 項目 | 要件 |
|------|------|
| 初期表示 | 3秒以内 |
| タイトル生成 | 10秒以内 |
| 構成案生成 | 15秒以内 |
| 本文生成（10,000文字） | 120秒以内 |

### 3.2 対応環境
| 項目 | 要件 |
|------|------|
| ブラウザ | Chrome, Safari, Firefox, Edge (最新版) |
| デバイス | PC, タブレット, スマートフォン |
| 画面サイズ | 320px以上（レスポンシブ対応） |

### 3.3 セキュリティ
| 項目 | 要件 |
|------|------|
| API Key | サーバーサイドで管理 (env) |
| HTTPS | 必須 |
| 入力サニタイズ | XSS対策実施 |

---

## 4. 技術仕様

### 4.1 技術スタック

#### フロントエンド
```yaml
Framework: React 18.2+
Language: TypeScript 5.0+
Build Tool: Vite 5.0+
Styling: Tailwind CSS 3.4+
State Management: React Context / useState
Storage: LocalStorage (for History Feature)
Markdown: react-markdown
Icons: Lucide React
```

#### バックエンド
```yaml
Runtime: Vercel Serverless Functions (Node.js 20)
AI API: Google Gemini API
  - Primary: gemini-2.0-flash-exp (Latest/Fastest)
  - Backup 1: gemini-1.5-flash
  - Backup 2: gemini-1.5-pro
  - Backup 3: gemini-pro (Legacy)
```

#### インフラ
```yaml
Hosting: Vercel
Source Control: GitHub
CI/CD: Vercel Git Integration
```

### 4.2 ディレクトリ構成
```
note-ai-agent/
├── .github/
│   └── workflows/
├── api/
│   ├── generate-title.ts
│   ├── generate-outline.ts
│   └── generate-body.ts
├── public/
│   ├── favicon.ico
│   └── og-image.png
├── report/
│   ├── 検証レポート_20251225.md
│   └── 仕様書_20251225_backup.md
├── src/
│   ├── components/
│   │   ├── common/
│   │   │   ├── Header.tsx
│   │   │   ├── TabNav.tsx
│   │   │   ├── Accordion.tsx
│   │   │   ├── Button.tsx
│   │   │   ├── Textarea.tsx
│   │   │   ├── Select.tsx
│   │   │   └── Loading.tsx
│   │   ├── input/
│   │   │   ├── KnowhowInput.tsx
│   │   │   ├── StrategySettings.tsx
│   │   │   └── BasicSettings.tsx
│   │   ├── generation/
│   │   │   ├── TitleSelector.tsx
│   │   │   ├── OutlineEditor.tsx
│   │   │   └── BodyPreview.tsx
│   │   ├── output/
│   │   │   ├── MarkdownPreview.tsx
│   │   │   └── ExportButtons.tsx
│   │   └── history/
│   │       └── HistoryList.tsx (New)
│   ├── contexts/
│   │   └── ArticleContext.tsx
│   ├── hooks/
│   │   ├── useArticle.ts
│   │   ├── useGeneration.ts
│   │   ├── useLocalStorage.ts
│   │   └── useHistory.ts (New)
│   ├── lib/
│   │   ├── api.ts
│   │   └── prompts.ts
│   ├── types/
│   │   └── index.ts
│   ├── App.tsx
│   ├── main.tsx
│   └── index.css
├── .env.example
├── .gitignore
├── package.json
├── tailwind.config.js
├── tsconfig.json
├── vite.config.ts
├── vercel.json
├── 予測見本プロンプト.md
└── 仕様書.md
```

---

## 5. API仕様

### 5.1 タイトル生成 API

#### エンドポイント
```
POST /api/generate-title
```

#### リクエスト
```typescript
interface TitleRequest {
  knowhow: string;
  strategy?: {
    target?: string;
    concept?: string;
    strength?: string;
  };
  settings: {
    audience: 'beginner' | 'intermediate' | 'advanced' | 'general';
    style: 'polite' | 'formal' | 'friendly';
  };
}
```

#### レスポンス
```typescript
interface TitleResponse {
  success: boolean;
  titles?: string[];
  error?: string;
}
```

### 5.2 構成案生成 API

#### エンドポイント
```
POST /api/generate-outline
```

#### リクエスト
```typescript
interface OutlineRequest {
  knowhow: string;
  selectedTitle: string;
  strategy?: {
    structure?: string;
  };
  settings: {
    wordCount: number;
    audience: string;
  };
}
```

#### レスポンス
```typescript
interface OutlineResponse {
  success: boolean;
  outline?: {
    sections: {
      level: number;      // 1=H2, 2=H3
      heading: string;
      summary: string;
    }[];
  };
  error?: string;
}
```

### 5.3 本文生成 API

#### エンドポイント
```
POST /api/generate-body
```

#### リクエスト
```typescript
interface BodyRequest {
  knowhow: string;
  selectedTitle: string;
  outline: {
    sections: { heading: string; summary: string }[];
  };
  strategy?: {
    otherInstructions?: string;
  };
  settings: {
    style: 'polite' | 'formal' | 'friendly';
    audience: string;
    wordCount: number;
  };
}
```

#### レスポンス
```typescript
interface BodyResponse {
  success: boolean;
  body?: {
    markdown: string;
    metaDescription: string;
    actualWordCount: number;
  };
  error?: string;
}
```

---

## 6. UI仕様

### 6.1 カラーパレット
```css
/* Primary */
--primary-50: #f0f9ff;
--primary-100: #e0f2fe;
--primary-500: #0ea5e9;
--primary-600: #0284c7;
--primary-700: #0369a1;

/* Neutral */
--gray-50: #f9fafb;
--gray-100: #f3f4f6;
--gray-200: #e5e7eb;
--gray-700: #374151;
--gray-900: #111827;

/* Accent */
--success: #10b981;
--warning: #f59e0b;
--error: #ef4444;
```

### 6.2 タイポグラフィ
```css
/* Font Family */
font-family: 'Noto Sans JP', sans-serif;

/* Font Sizes */
--text-xs: 0.75rem;
--text-sm: 0.875rem;
--text-base: 1rem;
--text-lg: 1.125rem;
--text-xl: 1.25rem;
--text-2xl: 1.5rem;
```

### 6.3 コンポーネント仕様

#### タブナビゲーション
- 4つのタブ: 入力 / タイトル案 / 構成案 / 本文
- アクティブタブはハイライト表示
- 未完了タブは非活性（段階的モード時）

#### アコーディオン
- 「戦略企画（わど式）」「基本設定」は展開可能
- デフォルトは閉じた状態
- 開閉アニメーション付き

#### ボタン
- Primary: 青系グラデーション
- Secondary: グレー
- Danger: 赤
- ホバー時に軽いスケールアップ

---

## 7. 入力パラメータ詳細

### 7.1 戦略企画（わど式）
| 項目 | フィールド名 | 説明 | 例 |
|------|-------------|------|-----|
| タイトル | title | 記事タイトル案 | 「Obsidianで第二の脳を作る」 |
| ターゲット・読者変容 | target | 想定読者と変化 | 「情報整理に悩む会社員 → 効率的に知識管理できる」 |
| 記事コンセプト | concept | 記事の核 | 「1週間で構築できるロードマップ」 |
| 記事の強み | strength | 差別化ポイント | 「初心者向け・具体的な手順」 |
| 記事構成 | structure | 大まかな構成 | 「Day1〜Day7の段階式」 |
| その他の指示 | otherInstructions | 追加要望 | 「FAQ追加」 |

### 7.2 基本設定
| 項目 | フィールド名 | 選択肢 | デフォルト |
|------|-------------|--------|----------|
| 文体 | style | ですます調 / である調 / フレンドリー | ですます調 |
| 読者層 | audience | 初心者 / 中級者 / 上級者 / 一般 | 初心者 |
| 文字数 | wordCount | 2500 / 5000 / 7500 / 10000 | 5000 |
| 画像テーマ | imageTheme | 任意テキスト | - |

---

## 8. エラーハンドリング

### 8.1 エラーコード
| コード | 説明 | ユーザーメッセージ |
|--------|------|------------------|
| E001 | API接続エラー | 接続に失敗しました。再試行してください。 |
| E002 | タイムアウト | 処理がタイムアウトしました。 |
| E003 | 入力不足 | ノウハウを入力してください。 |
| E004 | レート制限 | しばらく待ってから再試行してください。 |
| E005 | 生成失敗 | 生成に失敗しました。内容を変更してお試しください。 |

---

## 9. デプロイ設定

### 9.1 環境変数
```env
# Gemini API
GEMINI_API_KEY=your_api_key_here

# Optional
NEXT_PUBLIC_APP_URL=https://your-domain.vercel.app
```

### 9.2 Vercel設定 (vercel.json)
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "functions": {
    "api/*.ts": {
      "runtime": "nodejs20.x",
      "maxDuration": 60
    }
  }
}
```

---

## 10. テストケース

### 10.1 正常系
| ID | テスト内容 | 期待結果 |
|----|----------|---------|
| T001 | ノウハウ入力→タイトル生成 | 5つのタイトル候補が表示される |
| T002 | タイトル選択→構成生成 | 見出し一覧が表示される |
| T003 | 構成確定→本文生成 | Markdown形式の本文が表示される |
| T004 | 一括生成 | タイトル〜本文まで順次生成される |
| T005 | コピー機能 | クリップボードにコピーされる |
| T006 | 履歴保存 | 生成完了後に履歴としてローカルストレージに保存される |
| T007 | 履歴復元 | 履歴から選択した記事がエディタに復元される |

### 10.2 異常系
| ID | テスト内容 | 期待結果 |
|----|----------|---------|
| T101 | 空入力で生成 | エラーメッセージ表示 |
| T102 | API接続失敗 | リトライ案内表示 |
| T103 | 長文入力（10万文字超） | 文字数制限メッセージ |

---

## 11. 今後の拡張予定

### Phase 2 (将来)
- [ ] ユーザー認証機能
- [ ] テンプレート機能
- [ ] 画像自動生成（OGP等）
- [ ] note API連携（直接投稿）

---


## 12. 変更履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|----------|---------|--------|
| 2025-12-19 | 1.0.0 | 初版作成 | AI Agent |
| 2025-12-20 | 1.1.0 | Gemini 2.0 Flash導入、APIキーヘルスチェック機能追加、フォールバック戦略強化 | AI Agent |
| 2025-12-25 | 1.2.0 | プロンプト強度検証完了、履歴保存機能要件追加、ディレクトリ構成更新 | AI Agent |
